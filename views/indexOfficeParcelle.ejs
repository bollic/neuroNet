<%- include('layout/headerOfficeGeo') %>
<style>
  html, body { height: 100%; }
  #map { height: 100%; min-height: 80vh; }
  .leaflet-container {
    z-index: 0 !important;
  }
</style>
<style>
  #group-feed {
    max-height: none !important;   /* niente limite altezza */
    overflow-y: visible !important; /* elimina scrollbar verticale */
  }
</style>
<!-- Layout principale con drawer (sidebar a sinistra + mappa a destra) -->
<div class="drawer lg:drawer-open">
  <input id="my-drawer" type="checkbox" class="drawer-toggle" />

   <div class="drawer-content flex flex-col">

    <% if (message) { %>
      <div class="alert alert-<%= message.type || 'info' %> shadow-lg rounded-lg p-3">
        <i class="fas fa-exclamation-circle mr-2"></i>
        <strong><%= message.message %></strong>
      </div>
    <% } %>
   <!-- Contenuto principale (mappa) -->
    <div class="drawer-content relative"> 
     <!-- Pulsante toggle -->       
   <a class="absolute top-4 left-4 z-50">
          <label for="my-drawer" class="btn btn-primary btn-sm shadow-lg">
            ‚ò∞ Menu
          </label>
        </a>

     <!-- Qui va la mappa -->
         <div id="map" class="w-full h-[85vh] rounded-lg shadow-md"></div>
    </div>
   </div>
 
    <!-- Sidebar- a sinistra -->
  <div class="drawer-side">
  <!-- Filtri category e date-->
<div class="flex space-x-4 my-3">
  <!-- Filtro Category -->
  <select id="filter-category" class="select select-bordered">
    <option value="">Toutes le categories</option>
  </select>
  
  <!-- Filtro Data -->
  <input type="date" id="filter-date" class="input input-bordered" />
</div>
 <!-- Fine Filtri category e date-->
  <!-- Sidebar -->
    <label for="my-drawer" class="drawer-overlay"></label>
    <aside class="w-80 bg-base-200 p-4 overflow-y-auto">
      
      <!-- Tabella delle parcelle -->
      <% if (parcelles && parcelles.length > 0) { %>
        <div class="overflow-x-auto">
          <table id="main-table" class="table table-zebra w-full">
            <thead>
              <tr>
                <th>Name</th>
                <th>Category</th>
                
                 <th>Date</th>
                <th style="display:none;">createdAtISO</th>
                <th>Category</th>
              </tr>
            </thead>
            <tbody>
             
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="text-center text-secondary mt-5">
          Aucune parcelle trouv√©e dans la base de donn√©es!
        </div>
      <% } %>

    </aside>
  </div>
</div>


<script>
  const fieldUsers = <%- JSON.stringify(fieldUsers || []) %>;
  console.log("üîç fieldUsers nel template:", fieldUsers);
</script>
<script>
 window.FIELD_USERS = <%- JSON.stringify(fieldUsers || []) %>;
  window.PARCELLES = <%- JSON.stringify(parcelles || []) %>; 
  console.log("üîç fieldUsers nel template:", window.FIELD_USERS);
  console.log("üìä PARCELLES (client):", window.PARCELLES);
</script>


<%- include('layout/footerOffice') %>

<script src="/js/dataOfficeParcelle.js" defer></script>
