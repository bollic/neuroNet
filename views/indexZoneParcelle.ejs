<%- include('layout/headerZoneParcelle') %>

<style>
  html, body { height: 100%; }
  #map { height: 100%; min-height: 80vh; }
  .leaflet-container {
  z-index: 0 !important;
}
</style>
<style>
  #group-feed {
    max-height: none !important;   /* niente limite altezza */
    overflow-y: visible !important; /* elimina scrollbar verticale */
  }
</style>

   <!-- 1: inizio flex -->
<div class="flex flex-row h-[80vh]">
<!-- 2: drawer -->
    <div class="drawer drawer-start">
      <input id="my-drawer" type="checkbox" class="drawer-toggle" />

      <!-- Contenuto principale (mappa) -->
      <div class="drawer-content relative">
    <!-- Pulsante toggle sempre visibile -->
      <a class="absolute top-4 left-4 z-50">
        <label for="my-drawer" class="btn btn-primary btn-sm shadow-lg">
          â˜° Menu
        </label>
      </a>
          <!-- unica mappa -->
        <div id="map" class="w-full h-[80vh] rounded-lg shadow-md"></div>
            <!-- Pulsante flottante Add parcelle -->
        <a href="/addParcelle" class="absolute top-4 right-4 z-50">
          <button class="btn btn-warning btn-sm shadow-lg">
            <i class="fas fa-plus"></i>  Ajouter une parcelle
          </button>
        </a>
      </div>
      
        <!-- Sidebar- a sinistra -->
        <div class="drawer-side">
        <label for="my-drawer" class="drawer-overlay"></label>
        <aside class="w-80 bg-base-200 p-4 overflow-y-auto">
        
        <!-- Tabella parcelles -->    
  <% if (parcelles && parcelles.length > 0) { %>
    <div class="overflow-x-auto">
     <!-- AGGIUNGI id="main-table" QUI -->
   <table id="main-table" class="table table-zebra w-full"> 
     <thead class="table-dark">
         <tr>
            <th>Numero</th>
            <th>Name</th>           
             <th>Action</th>
          </tr>
        </thead>
        <tbody>
<% parcelles.forEach((parcelle, index) => { %>
  <% const coordinates = parcelle.geometry.coordinates[0] || []; %>
  <% coordinates.forEach((coord, i) => { %>
    <tr>
      <td><%= i + 1 %></td>
      <td><%= parcelle.name %></td>     
      <td> 
      <a href="/delete-point/<%= parcelle._id %>?lat=<%= coord[1] %>&lng=<%= coord[0] %>" class="btn btn-sm btn-outline-danger">
         <i class="fas fa-trash"></i>
       </a>
      </td>
    </tr>
  <% }) %>
<% }) %>

        </tbody>
      </table>
    </div>
  <% } else { %>
    <div class="text-center text-secondary mt-5">
              Aucune parcelle trouvÃ©e pour vous ! Ajoutez votre premiÃ¨re parcelle ðŸŒ±
            </div>
  <% } %>
      
  
      </aside>
    </div>
  </div>
</div>


<script>

  // Variabile JS usata dal client
  const parcelles = <%- JSON.stringify(parcelles || []) %>;
  console.log("ðŸ“¦ Parcelles dal server:", <%- JSON.stringify(parcelles) %>);
  window.CATEGORIES = <%- JSON.stringify(categories || []) %>;     
   console.log("ðŸ§ª CATEGORIES DAL SERVER:", window.CATEGORIES);
</script>

<script type="module" src="/js/dataAuthorParcelle.js" defer></script>
<%- include('layout/footer') %>

